const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = 'https://gxzsxvbercpkgxraiaex.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4enN4dmJlcmNwa2d4cmFpYWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NjMyNzAsImV4cCI6MjA3NzEzOTI3MH0.6sJ7PJ2imo9-mzuYdqRlhQty7PCQAzpSKfcQ5ve571g';
const supabase = createClient(supabaseUrl, supabaseKey);

const BUSINESS_ID = '11111111-1111-1111-1111-111111111111';

const suppliers = {
    'ברכת האדמה': 5,
    'כוכב השחר': 2,
    'פיצה מרקט': 3,
    'ביסקוטי': 1,
    'תנובה': 6
};

const fullInventory = [
    // ברכת האדמה
    { name: 'חלב פרה', s: 'ברכת האדמה', u: 'מ"ל', w: 1000, c: 'חומרי גלם' },
    { name: 'חלב סויה', s: 'ברכת האדמה', u: 'מ"ל', w: 1000, c: 'חומרי גלם' },
    { name: 'חלב שיבולת שועל', s: 'ברכת האדמה', u: 'מ"ל', w: 1000, c: 'חומרי גלם' },
    { name: 'חסה לאליק', s: 'ברכת האדמה', u: 'גרם', w: 800, c: 'ירקות' },
    { name: 'אננס קפוא', s: 'ברכת האדמה', u: 'גרם', w: 1000, c: 'פירות קפואים' },
    { name: 'מנגו קפוא', s: 'ברכת האדמה', u: 'גרם', w: 1000, c: 'פירות קפואים' },
    { name: 'בננה קפואה', s: 'ברכת האדמה', u: 'גרם', w: 1000, c: 'פירות קפואים' },
    { name: 'תות קפוא', s: 'ברכת האדמה', u: 'גרם', w: 1000, c: 'פירות קפואים' },
    { name: 'פרלינים', s: 'ברכת האדמה', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'מיץ תפוחים', s: 'ברכת האדמה', u: 'מ"ל', w: 2000, c: 'מיצים' },
    { name: 'מיץ תפוזים', s: 'ברכת האדמה', u: 'מ"ל', w: 2000, c: 'מיצים' },
    { name: 'לימונדה', s: 'ברכת האדמה', u: 'מ"ל', w: 2000, c: 'מיצים' },

    // כוכב השחר
    { name: 'מלפפון', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'גזר', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'עגבניה', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'דלעת', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'פלפל אדום', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'ערמונים', s: 'כוכב השחר', u: 'גרם', w: 500, c: 'ירקות' },
    { name: 'פלפל צהוב', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'פטריות', s: 'כוכב השחר', u: 'מארז', w: 1, c: 'ירקות' },
    { name: 'שרי (קופסאות)', s: 'כוכב השחר', u: 'מארז', w: 1, c: 'ירקות' },
    { name: 'קישוא', s: 'כוכב השחר', u: 'ק"ג', w: 1000, c: 'ירקות' },
    { name: 'סלק בואקום', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'ירקות' },
    { name: 'בצל סגול', s: 'כוכב השחר', u: 'ק"ג', w: 1, c: 'ירקות' },
    { name: 'דלורית', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'ירקות' },
    { name: 'בצל לבן', s: 'כוכב השחר', u: 'ק"ג', w: 1, c: 'ירקות' },
    { name: 'שום', s: 'כוכב השחר', u: 'מארז', w: 1, c: 'ירקות' },
    { name: 'חציל', s: 'כוכב השחר', u: 'ק"ג', w: 1, c: 'ירקות' },
    { name: 'תפוא', s: 'כוכב השחר', u: 'ק"ג', w: 1, c: 'ירקות' },
    { name: 'בטטה', s: 'כוכב השחר', u: 'ק"ג', w: 1, c: 'ירקות' },
    { name: 'לחם טוסט', s: 'כוכב השחר', u: 'חבילה', w: 10, c: 'לחמים' },
    { name: 'לחם לבן', s: 'כוכב השחר', u: 'חבילה', w: 10, c: 'לחמים' },
    { name: 'לחם חום', s: 'כוכב השחר', u: 'חבילה', w: 10, c: 'לחמים' },
    { name: 'גבינת קממבר', s: 'כוכב השחר', u: 'גרם', w: 125, c: 'גבינות' },
    { name: 'גבינת מעז', s: 'כוכב השחר', u: 'גרם', w: 180, c: 'גבינות' },
    { name: 'חמאה', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'גבינות' },
    { name: 'דבש', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'מלח', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'ריבה', s: 'כוכב השחר', u: 'גרם', w: 370, c: 'שונות' },
    { name: 'מלח גס', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'סלמון מעושן', s: 'כוכב השחר', u: 'גרם', w: 100, c: 'שונות' },
    { name: 'טחינה', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'גלידה', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'ביצים', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'אבקת סוכר', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'שוקולית', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'סבון כלים', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'סוכר', s: 'כוכב השחר', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'נייר טואלט', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'שקיות זבל גדולות', s: 'כוכב השחר', u: 'יח׳', w: 1, c: 'שונות' },

    // פיצה מרקט
    { name: 'בצק פיצה', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'פיצה' },
    { name: 'זיתים', s: 'פיצה מרקט', u: 'גרם', w: 2000, c: 'פיצה' },
    { name: 'בצק עם רוטב', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'פיצה' },
    { name: 'גבינה בולגרית (פיצה)', s: 'פיצה מרקט', u: 'גרם', w: 3600, c: 'פיצה' },
    { name: 'גבנצ מגורדת', s: 'פיצה מרקט', u: 'גרם', w: 2000, c: 'פיצה' },
    { name: 'גבינת שמנת', s: 'פיצה מרקט', u: 'גרם', w: 2000, c: 'פיצה' },
    { name: 'רוטב פסטו', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'פיצה' },
    { name: 'שקיות תבלין פיצה', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'פיצה' },
    { name: 'קופסת סלט', s: 'פיצה מרקט', u: 'יח׳', w: 25, c: 'אריזות' },
    { name: 'מכסה סלט', s: 'פיצה מרקט', u: 'יח׳', w: 25, c: 'אריזות' },
    { name: 'שקיות חומות', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'אריזות' },
    { name: 'שקיות מאפים', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'אריזות' },
    { name: 'שקיות כריכים ארוך', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'אריזות' },
    { name: 'רוטב אישי שום', s: 'פיצה מרקט', u: 'יח׳', w: 128, c: 'רטבים' },
    { name: 'רוטב אישי אלף האיים', s: 'פיצה מרקט', u: 'יח׳', w: 128, c: 'רטבים' },
    { name: 'רוטב אישי ויניגרט', s: 'פיצה מרקט', u: 'יח׳', w: 128, c: 'רטבים' },
    { name: 'אגוז מוסקט', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'תבלינים' },
    { name: 'פלפל שחור', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'תבלינים' },
    { name: 'אורגנו', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'תבלינים' },
    { name: 'פסטה', s: 'פיצה מרקט', u: 'גרם', w: 5000, c: 'שונות' },
    { name: 'קשים', s: 'פיצה מרקט', u: 'שקית', w: 1, c: 'אריזות' },
    { name: 'ג\'עלה', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'ממרח קקאו ולוז', s: 'פיצה מרקט', u: 'גרם', w: 5000, c: 'שונות' },
    { name: 'אגוז מלך', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'ממרח שוקולד לבן', s: 'פיצה מרקט', u: 'גרם', w: 5000, c: 'שונות' },
    { name: 'מגשי קרטון לפיצה', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'אריזות' },
    { name: 'טרופיות', s: 'פיצה מרקט', u: 'יח׳', w: 40, c: 'מיצים' },
    { name: 'אבקת אייס קפה', s: 'פיצה מרקט', u: 'גרם', w: 1000, c: 'שונות' },
    { name: 'ערכות סכום', s: 'פיצה מרקט', u: 'יח׳', w: 500, c: 'אריזות' },
    { name: 'תרכיז לברד', s: 'פיצה מרקט', u: 'מ"ל', w: 5000, c: 'שונות' },
    { name: 'שקיות גופיה', s: 'פיצה מרקט', u: 'גליל', w: 1, c: 'אריזות' },
    { name: 'גליל נייר ניגוב', s: 'פיצה מרקט', u: 'יח׳', w: 1, c: 'שונות' },
    { name: 'שמן זית', s: 'פיצה מרקט', u: 'מ"ל', w: 3800, c: 'שונות' }
];

async function finalMassImport() {
    console.log(`🚀 MASS IMPORT STARTED (${fullInventory.length} items)`);

    for (const item of fullInventory) {
        const supplierId = suppliers[item.s] || 6;

        try {
            const { data, error } = await supabase.rpc('create_missing_inventory_item_v2', {
                p_name: item.name,
                p_unit: item.u,
                p_business_id: BUSINESS_ID,
                p_supplier_id: supplierId,
                p_cost_per_unit: 0,
                p_catalog_item_id: null
            });

            if (error) {
                if (error.message.includes('unique constraint')) {
                    console.log(`⏭️ Skipping (already exists): ${item.name}`);
                } else {
                    console.error(`❌ Error ${item.name}: ${error.message}`);
                }
            } else {
                console.log(`✅ Created: ${item.name} (ID: ${data})`);
            }
        } catch (e) {
            console.error(`💥 Fatal error for ${item.name}`);
        }
    }
    console.log('🎉 MASS IMPORT COMPLETED!');
}

finalMassImport();
